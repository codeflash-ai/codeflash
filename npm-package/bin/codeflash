#!/usr/bin/env node
/**
 * Wrapper script for codeflash CLI.
 * Invokes the downloaded binary with all passed arguments.
 */

const { spawn } = require('child_process');
const path = require('path');
const fs = require('fs');

function getBinaryPath() {
  const binDir = __dirname;
  const isWindows = process.platform === 'win32';
  return path.join(binDir, isWindows ? 'codeflash.exe' : 'codeflash-binary');
}

function main() {
  const binaryPath = getBinaryPath();

  if (!fs.existsSync(binaryPath)) {
    console.error('\x1b[31mError: codeflash binary not found.\x1b[0m');
    console.error('Try reinstalling: npm install codeflash');
    process.exit(1);
  }

  // Pass all arguments to the binary
  const args = process.argv.slice(2);

  const child = spawn(binaryPath, args, {
    stdio: 'inherit',
    env: process.env,
  });

  child.on('error', (error) => {
    console.error(`\x1b[31mError running codeflash: ${error.message}\x1b[0m`);
    process.exit(1);
  });

  child.on('exit', (code, signal) => {
    if (signal) {
      process.exit(1);
    }
    process.exit(code || 0);
  });
}

main();
